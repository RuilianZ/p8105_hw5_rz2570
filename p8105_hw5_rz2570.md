p8105\_hw5
================
Ruilian Zhang
11/12/2021

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

## Problem 1

``` r
homicide_df = read_csv("data/homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state, sep = ", "))
```

    ## Rows: 52179 Columns: 12

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
n_homicides_df = homicide_df %>% 
  group_by(city_state) %>% 
  summarize(
    n_homicides = n()
  )

n_unsolved_df = homicide_df %>% 
  group_by(city_state) %>% 
  filter(disposition %in% c("Closed without arrest", "Open/No arrest")) %>% 
  summarize(
    n_unsolved = n()
  )

city_summary_df = left_join(n_homicides_df, n_unsolved_df, by = "city_state") %>% 
  mutate(n_unsolved = replace_na(n_unsolved, 0))

knitr::kable(city_summary_df)
```

| city\_state        | n\_homicides | n\_unsolved |
|:-------------------|-------------:|------------:|
| Albuquerque, NM    |          378 |         146 |
| Atlanta, GA        |          973 |         373 |
| Baltimore, MD      |         2827 |        1825 |
| Baton Rouge, LA    |          424 |         196 |
| Birmingham, AL     |          800 |         347 |
| Boston, MA         |          614 |         310 |
| Buffalo, NY        |          521 |         319 |
| Charlotte, NC      |          687 |         206 |
| Chicago, IL        |         5535 |        4073 |
| Cincinnati, OH     |          694 |         309 |
| Columbus, OH       |         1084 |         575 |
| Dallas, TX         |         1567 |         754 |
| Denver, CO         |          312 |         169 |
| Detroit, MI        |         2519 |        1482 |
| Durham, NC         |          276 |         101 |
| Fort Worth, TX     |          549 |         255 |
| Fresno, CA         |          487 |         169 |
| Houston, TX        |         2942 |        1493 |
| Indianapolis, IN   |         1322 |         594 |
| Jacksonville, FL   |         1168 |         597 |
| Kansas City, MO    |         1190 |         486 |
| Las Vegas, NV      |         1381 |         572 |
| Long Beach, CA     |          378 |         156 |
| Los Angeles, CA    |         2257 |        1106 |
| Louisville, KY     |          576 |         261 |
| Memphis, TN        |         1514 |         483 |
| Miami, FL          |          744 |         450 |
| Milwaukee, wI      |         1115 |         403 |
| Minneapolis, MN    |          366 |         187 |
| Nashville, TN      |          767 |         278 |
| New Orleans, LA    |         1434 |         930 |
| New York, NY       |          627 |         243 |
| Oakland, CA        |          947 |         508 |
| Oklahoma City, OK  |          672 |         326 |
| Omaha, NE          |          409 |         169 |
| Philadelphia, PA   |         3037 |        1360 |
| Phoenix, AZ        |          914 |         504 |
| Pittsburgh, PA     |          631 |         337 |
| Richmond, VA       |          429 |         113 |
| Sacramento, CA     |          376 |         139 |
| San Antonio, TX    |          833 |         357 |
| San Bernardino, CA |          275 |         170 |
| San Diego, CA      |          461 |         175 |
| San Francisco, CA  |          663 |         336 |
| Savannah, GA       |          246 |         115 |
| St. Louis, MO      |         1677 |         905 |
| Stockton, CA       |          444 |         266 |
| Tampa, FL          |          208 |          95 |
| Tulsa, AL          |            1 |           0 |
| Tulsa, OK          |          583 |         193 |
| Washington, DC     |         1345 |         589 |

``` r
baltimore_prop = prop.test(x = c(1825, 1002), n = c(2827, 2827), alternative = "two.sided")

baltimore_prop_tidy = broom::tidy(baltimore_prop, conf.int = TRUE)

pull(baltimore_prop_tidy, estimate1)
```

    ## [1] 0.6455607

``` r
c(pull(baltimore_prop_tidy, conf.low), pull(baltimore_prop_tidy, conf.high))
```

    ## [1] 0.2658309 0.3164118

-   For unsolved homicides in Baltimore, the estimated proportion is
    0.6455607. The confidence interval is (0.2658309, 0.3164118).

``` r
city_summary_nested = nest(city_summary_df, data = c("n_homicides", "n_unsolved"))

city_prop = function(df) {
  
  n = df[[1]]
  n1 = df[[2]]
  n2 = n - n1
  
  prop_test = prop.test(c(n1, n2), c(n, n), alternative = "two.sided") %>% 
    broom::tidy(conf.int = TRUE)
  
  tibble(
    unsolved_prop = pull(prop_test, estimate1),
    conf_int = str_c(pull(prop_test, conf.low), pull(prop_test, conf.high), sep = ", ")
    )
    
  }

city_prop(city_summary_nested$data[[3]])
```

    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                           
    ##           <dbl> <chr>                              
    ## 1         0.646 0.26583085849983, 0.316411801563842

``` r
map(city_summary_nested$data, city_prop)
```

    ## Warning in prop.test(c(n1, n2), c(n, n), alternative = "two.sided"): Chi-squared
    ## approximation may be incorrect

    ## [[1]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.386 -0.299572528447782, -0.155453926578673
    ## 
    ## [[2]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.383 -0.277530815514532, -0.189067334536856
    ## 
    ## [[3]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                           
    ##           <dbl> <chr>                              
    ## 1         0.646 0.26583085849983, 0.316411801563842
    ## 
    ## [[4]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.462 -0.14494366937432, -0.00599972685209532
    ## 
    ## [[5]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.434 -0.182317074812015, -0.0826829251879854
    ## 
    ## [[6]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.505 -0.0477845335163549, 0.067328507457723
    ## 
    ## [[7]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.612 0.163482027493801, 0.285654248897753
    ## 
    ## [[8]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.300 -0.450201226583561, -0.350381015046715
    ## 
    ## [[9]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.736 0.455119255392963, 0.488331512448048
    ## 
    ## [[10]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.445 -0.163242796143513, -0.0557773767671502
    ## 
    ## [[11]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                             
    ##           <dbl> <chr>                                
    ## 1         0.530 0.0179473632950558, 0.103823854417121
    ## 
    ## [[12]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                                 
    ##           <dbl> <chr>                                    
    ## 1         0.481 -0.0732754233432419, -0.00202770365101455
    ## 
    ## [[13]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.542 0.00193976141883961, 0.164726905247827
    ## 
    ## [[14]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                           
    ##           <dbl> <chr>                              
    ## 1         0.588 0.149081367984159, 0.20423343947912
    ## 
    ## [[15]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.366 -0.352106393214464, -0.184125490843507
    ## 
    ## [[16]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.464 -0.131859244506611, -0.0102172582256299
    ## 
    ## [[17]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.347 -0.367797939023378, -0.244111711900646
    ## 
    ## [[18]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.507 -0.010932461614894, 0.0408440863599655
    ## 
    ## [[19]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.449 -0.140038569663827, -0.0626845770835258
    ## 
    ## [[20]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.511 -0.0191377853969766, 0.0636583333421821
    ## 
    ## [[21]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.408 -0.223529067496551, -0.142857487125298
    ## 
    ## [[22]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.414 -0.209079366582741, -0.134150177226093
    ## 
    ## [[23]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.413 -0.247436888654106, -0.101769460552243
    ## 
    ## [[24]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                                
    ##           <dbl> <chr>                                   
    ## 1         0.490 -0.0495473123940572, 0.00967137087877148
    ## 
    ## [[25]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.453 -0.152977777166486, -0.0345222228335135
    ## 
    ## [[26]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.319 -0.395818576280628, -0.328091595449887
    ## 
    ## [[27]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.605 0.158653102207639, 0.260701736502038
    ## 
    ## [[28]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.361 -0.317905818430296, -0.236354271255802
    ## 
    ## [[29]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.511 -0.053299362907419, 0.0970152099019546
    ## 
    ## [[30]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.362 -0.3245128399945, -0.225682727150219
    ## 
    ## [[31]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.649 0.261427889732684, 0.332714369681542
    ## 
    ## [[32]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.388 -0.280405292307126, -0.169355473243113
    ## 
    ## [[33]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.536 0.026889581890168, 0.118833754963053
    ## 
    ## [[34]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.485 -0.0846887177386234, 0.025164908214814
    ## 
    ## [[35]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.413 -0.243527204020907, -0.103661060037773
    ## 
    ## [[36]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.448 -0.129719641821131, -0.0790390015769595
    ## 
    ## [[37]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                             
    ##           <dbl> <chr>                                
    ## 1         0.551 0.0561520013305954, 0.149537276568748
    ## 
    ## [[38]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                             
    ##           <dbl> <chr>                                
    ## 1         0.534 0.0115173083771485, 0.124774292256766
    ## 
    ## [[39]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.263 -0.534471232059454, -0.411915714327492
    ## 
    ## [[40]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.370 -0.332300065509358, -0.188976530235323
    ## 
    ## [[41]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.429 -0.191583831790814, -0.0941304539234716
    ## 
    ## [[42]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                           
    ##           <dbl> <chr>                              
    ## 1         0.618 0.151522200245402, 0.32120507248187
    ## 
    ## [[43]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.380 -0.305599050538077, -0.175962771587736
    ## 
    ## [[44]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.507 -0.0417527201653828, 0.068902041432351
    ## 
    ## [[45]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.467 -0.157280595198621, 0.0271992943856128
    ## 
    ## [[46]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                             
    ##           <dbl> <chr>                                
    ## 1         0.540 0.0449757645558013, 0.113640812665427
    ## 
    ## [[47]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                            
    ##           <dbl> <chr>                               
    ## 1         0.599 0.131478650169313, 0.264917746227083
    ## 
    ## [[48]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.457 -0.187080794350448, 0.0140038712735249
    ## 
    ## [[49]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int
    ##           <dbl> <chr>   
    ## 1             0 -1, 0   
    ## 
    ## [[50]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                              
    ##           <dbl> <chr>                                 
    ## 1         0.331 -0.393644710689283, -0.282170040597166
    ## 
    ## [[51]]
    ## # A tibble: 1 × 2
    ##   unsolved_prop conf_int                               
    ##           <dbl> <chr>                                  
    ## 1         0.438 -0.162404208655164, -0.0859229288913041
