p8105\_hw5
================
Ruilian Zhang
11/12/2021

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

## Problem 1

``` r
homicide_df = read_csv("data/homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state, sep = ", "))
```

    ## Rows: 52179 Columns: 12

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
n_homicides_df = homicide_df %>% 
  group_by(city_state) %>% 
  summarize(
    n_homicides = n()
  )

n_unsolved_df = homicide_df %>% 
  group_by(city_state) %>% 
  filter(disposition %in% c("Closed without arrest", "Open/No arrest")) %>% 
  summarize(
    n_unsolved = n()
  )

city_summary_df = left_join(n_homicides_df, n_unsolved_df, by = "city_state") %>% 
  mutate(n_unsolved = replace_na(n_unsolved, 0))

knitr::kable(city_summary_df)
```

| city\_state        | n\_homicides | n\_unsolved |
|:-------------------|-------------:|------------:|
| Albuquerque, NM    |          378 |         146 |
| Atlanta, GA        |          973 |         373 |
| Baltimore, MD      |         2827 |        1825 |
| Baton Rouge, LA    |          424 |         196 |
| Birmingham, AL     |          800 |         347 |
| Boston, MA         |          614 |         310 |
| Buffalo, NY        |          521 |         319 |
| Charlotte, NC      |          687 |         206 |
| Chicago, IL        |         5535 |        4073 |
| Cincinnati, OH     |          694 |         309 |
| Columbus, OH       |         1084 |         575 |
| Dallas, TX         |         1567 |         754 |
| Denver, CO         |          312 |         169 |
| Detroit, MI        |         2519 |        1482 |
| Durham, NC         |          276 |         101 |
| Fort Worth, TX     |          549 |         255 |
| Fresno, CA         |          487 |         169 |
| Houston, TX        |         2942 |        1493 |
| Indianapolis, IN   |         1322 |         594 |
| Jacksonville, FL   |         1168 |         597 |
| Kansas City, MO    |         1190 |         486 |
| Las Vegas, NV      |         1381 |         572 |
| Long Beach, CA     |          378 |         156 |
| Los Angeles, CA    |         2257 |        1106 |
| Louisville, KY     |          576 |         261 |
| Memphis, TN        |         1514 |         483 |
| Miami, FL          |          744 |         450 |
| Milwaukee, wI      |         1115 |         403 |
| Minneapolis, MN    |          366 |         187 |
| Nashville, TN      |          767 |         278 |
| New Orleans, LA    |         1434 |         930 |
| New York, NY       |          627 |         243 |
| Oakland, CA        |          947 |         508 |
| Oklahoma City, OK  |          672 |         326 |
| Omaha, NE          |          409 |         169 |
| Philadelphia, PA   |         3037 |        1360 |
| Phoenix, AZ        |          914 |         504 |
| Pittsburgh, PA     |          631 |         337 |
| Richmond, VA       |          429 |         113 |
| Sacramento, CA     |          376 |         139 |
| San Antonio, TX    |          833 |         357 |
| San Bernardino, CA |          275 |         170 |
| San Diego, CA      |          461 |         175 |
| San Francisco, CA  |          663 |         336 |
| Savannah, GA       |          246 |         115 |
| St. Louis, MO      |         1677 |         905 |
| Stockton, CA       |          444 |         266 |
| Tampa, FL          |          208 |          95 |
| Tulsa, AL          |            1 |           0 |
| Tulsa, OK          |          583 |         193 |
| Washington, DC     |         1345 |         589 |

``` r
baltimore_prop = prop.test(x = c(1825, 1002), n = c(2827, 2827), alternative = "two.sided")

baltimore_prop_tidy = broom::tidy(baltimore_prop, conf.int = TRUE)

pull(baltimore_prop_tidy, estimate1)
```

    ## [1] 0.6455607

``` r
c(pull(baltimore_prop_tidy, conf.low), pull(baltimore_prop_tidy, conf.high))
```

    ## [1] 0.2658309 0.3164118

-   For unsolved homicides in Baltimore, the estimated proportion is
    0.6455607. The confidence interval is (0.2658309, 0.3164118).

``` r
city_summary_nested = nest(city_summary_df, data = c("n_homicides", "n_unsolved"))

city_prop = function(df) {
  
  n = df[[1]]
  n1 = df[[2]]
  n2 = n - n1
  
  prop_test = prop.test(c(n1, n2), c(n, n), alternative = "two.sided") %>% 
    broom::tidy(conf.int = TRUE)
  
  tibble(
    unsolved_prop = round(pull(prop_test, estimate1), 2),
    conf_int = str_c(round(pull(prop_test, conf.low), 2),  round(pull(prop_test, conf.high), 2), sep = ", ")
    )
    
  }

city_summary_nested %>% 
  mutate(prop_results = map(data, city_prop)) %>% 
  unnest(prop_results) %>% 
  select(-data) %>% 
  knitr::kable()
```

    ## Warning in prop.test(c(n1, n2), c(n, n), alternative = "two.sided"): Chi-squared
    ## approximation may be incorrect

| city\_state        | unsolved\_prop | conf\_int    |
|:-------------------|---------------:|:-------------|
| Albuquerque, NM    |           0.39 | -0.3, -0.16  |
| Atlanta, GA        |           0.38 | -0.28, -0.19 |
| Baltimore, MD      |           0.65 | 0.27, 0.32   |
| Baton Rouge, LA    |           0.46 | -0.14, -0.01 |
| Birmingham, AL     |           0.43 | -0.18, -0.08 |
| Boston, MA         |           0.50 | -0.05, 0.07  |
| Buffalo, NY        |           0.61 | 0.16, 0.29   |
| Charlotte, NC      |           0.30 | -0.45, -0.35 |
| Chicago, IL        |           0.74 | 0.46, 0.49   |
| Cincinnati, OH     |           0.45 | -0.16, -0.06 |
| Columbus, OH       |           0.53 | 0.02, 0.1    |
| Dallas, TX         |           0.48 | -0.07, 0     |
| Denver, CO         |           0.54 | 0, 0.16      |
| Detroit, MI        |           0.59 | 0.15, 0.2    |
| Durham, NC         |           0.37 | -0.35, -0.18 |
| Fort Worth, TX     |           0.46 | -0.13, -0.01 |
| Fresno, CA         |           0.35 | -0.37, -0.24 |
| Houston, TX        |           0.51 | -0.01, 0.04  |
| Indianapolis, IN   |           0.45 | -0.14, -0.06 |
| Jacksonville, FL   |           0.51 | -0.02, 0.06  |
| Kansas City, MO    |           0.41 | -0.22, -0.14 |
| Las Vegas, NV      |           0.41 | -0.21, -0.13 |
| Long Beach, CA     |           0.41 | -0.25, -0.1  |
| Los Angeles, CA    |           0.49 | -0.05, 0.01  |
| Louisville, KY     |           0.45 | -0.15, -0.03 |
| Memphis, TN        |           0.32 | -0.4, -0.33  |
| Miami, FL          |           0.60 | 0.16, 0.26   |
| Milwaukee, wI      |           0.36 | -0.32, -0.24 |
| Minneapolis, MN    |           0.51 | -0.05, 0.1   |
| Nashville, TN      |           0.36 | -0.32, -0.23 |
| New Orleans, LA    |           0.65 | 0.26, 0.33   |
| New York, NY       |           0.39 | -0.28, -0.17 |
| Oakland, CA        |           0.54 | 0.03, 0.12   |
| Oklahoma City, OK  |           0.49 | -0.08, 0.03  |
| Omaha, NE          |           0.41 | -0.24, -0.1  |
| Philadelphia, PA   |           0.45 | -0.13, -0.08 |
| Phoenix, AZ        |           0.55 | 0.06, 0.15   |
| Pittsburgh, PA     |           0.53 | 0.01, 0.12   |
| Richmond, VA       |           0.26 | -0.53, -0.41 |
| Sacramento, CA     |           0.37 | -0.33, -0.19 |
| San Antonio, TX    |           0.43 | -0.19, -0.09 |
| San Bernardino, CA |           0.62 | 0.15, 0.32   |
| San Diego, CA      |           0.38 | -0.31, -0.18 |
| San Francisco, CA  |           0.51 | -0.04, 0.07  |
| Savannah, GA       |           0.47 | -0.16, 0.03  |
| St. Louis, MO      |           0.54 | 0.04, 0.11   |
| Stockton, CA       |           0.60 | 0.13, 0.26   |
| Tampa, FL          |           0.46 | -0.19, 0.01  |
| Tulsa, AL          |           0.00 | -1, 0        |
| Tulsa, OK          |           0.33 | -0.39, -0.28 |
| Washington, DC     |           0.44 | -0.16, -0.09 |
